<div class='body'>
  <div class="row">
    <div class="col-lg-12">
      <div class="row d-flex justify-content-end align-items-center">
        <div class="source-label">数据来源：</div>
        <div id="result-source-buttons">
          <button type="button" class="btn btn-outline-danger" [ngClass]="{'active': !penguinService.isPersonal}"
            (click)="selectDataSource(false)">
            全平台
          </button>
          <button type="button" class="btn btn-outline-danger" [ngClass]="{'active': penguinService.isPersonal}"
            (click)="selectDataSource(true)">
            本地
          </button>
        </div>
      </div>
      <div class="row">
        <div class="drop-label">章节</div>
      </div>
      <div class="row standard-margin-top">
        <div *ngIf="!chapterList || !chapterList.length">
          企鹅读取中……
        </div>
        <div class="stage-buttons d-flex justify-content-start flex-wrap align-content-between">
          <div class="stage-button-container" *ngFor="let chapter of chapterList">
            <button type="button" class="btn btn-outline-primary"
              [ngClass]="{'active': selectedService.selections.result_by_stage.selectedChapter && selectedService.selections.result_by_stage.selectedChapter.zoneId === chapter.zoneId}"
              (click)="selectChapter(chapter)">
              {{chapter.zoneName}}
            </button>
          </div>
        </div>
      </div>

      <div *ngIf="selectedService.selections.result_by_stage.selectedChapter">
        <div class="row standard-margin-top">
          <div class="drop-label">作战</div>
        </div>
        <div class="row standard-margin-top">
          <div *ngIf="!stageList || !stageList.length">
            企鹅读取中……
          </div>
          <div class="stage-buttons d-flex justify-content-start flex-wrap align-content-between">
            <div class="stage-button-container" *ngFor="let stage of stageList">
              <button type="button" class="btn btn-outline-primary"
                [ngClass]="{'active': selectedService.selections.result_by_stage.selectedStage && selectedService.selections.result_by_stage.selectedStage.stageId === stage.stageId}"
                (click)="selectStage(stage)">
                {{stage.code}}
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row result-label" *ngIf="selectedService.selections.result_by_stage.selectedStage">
        {{selectedService.selections.result_by_stage.selectedStage.code}}
      </div>
      <div class="row result-tip" *ngIf="!isLoading && stageResult && showTable">
        （左右滑动查看完整数据）
      </div>
      <div class="row" style="margin-top: 1rem;" *ngIf="showTable">
        <div class="col-12" [ngClass]="{'table-responsive': !isLoading}">
          <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8"
            (matSortChange)="sortStageData($event)">
            <ng-container matColumnDef="material">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>素材</th>
              <td mat-cell *matCellDef="let row">
                <div class="material-container-for-stage-result" style="margin: 0;" *ngIf="row.item.iconUrl">
                  <div class="material-img-container hover-pointer"
                    [ngStyle]="{ 'background-image': 'url(' + row.item.iconUrl + ')'}"
                    (click)="redirectToItemResult(row.item)"></div>
                </div>
              </td>
            </ng-container>
            <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>名称</th>
              <td mat-cell *matCellDef="let row">
                <button class="url-button" (click)="redirectToItemResult(row.item)">{{row.item.name}}</button>
              </td>
            </ng-container>
            <ng-container matColumnDef="times">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>样本数</th>
              <td mat-cell *matCellDef="let row">
                {{row.times}}
              </td>
            </ng-container>
            <ng-container matColumnDef="quantity">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>掉落个数</th>
              <td mat-cell *matCellDef="let row">
                {{row.quantity}}
              </td>
            </ng-container>
            <ng-container matColumnDef="rate">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>掉落率</th>
              <td mat-cell *matCellDef="let row">
                {{row.rate}}%
              </td>
            </ng-container>
            <ng-container matColumnDef="expectation">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>单个掉落期望理智</th>
              <td mat-cell *matCellDef="let row">
                {{row.expectation}}
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
          <mat-card *ngIf="isLoading" style="display: flex; justify-content: center; align-items: center">
            <mat-progress-spinner color="primary" mode="indeterminate">
            </mat-progress-spinner>
          </mat-card>
        </div>
      </div>
    </div>
  </div>
</div>